---
import '../styles/globals.css';

const defaultTitle = 'Assetto Corsa Lap Board';
const defaultDescription = 'Lap time board generated from personalbest.ini and rendered with Astro.';
const siteUrl = Astro.site?.href ?? 'https://example.com';
const urlPath = Astro.url?.pathname ?? '/';
const title = Astro.props.title ?? defaultTitle;
const description = Astro.props.description ?? defaultDescription;
const image = Astro.props.image ?? `${siteUrl}/images/preview.png`;
const imageAlt = Astro.props.imageAlt ?? 'Lap time preview';
const ogType = Astro.props.ogType ?? 'website';
const navLinks = [
  { label: 'Lap Time Board', href: '/assetto-corsa' },
  { label: 'Docs', href: 'https://github.com/yeftakun/my-site/tree/main' },
];
---
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={new URL(urlPath, siteUrl).href} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={new URL(urlPath, siteUrl).href} />
    <meta property="og:image" content={image} />
    <meta property="og:image:alt" content={imageAlt} />
    <meta name="theme-color" content="#2a5bff" />
    <script is:inline>
      (() => {
        const root = document.documentElement;
        const stored = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const shouldUseDark = stored ? stored === 'dark' : prefersDark;
        root.classList.toggle('dark', shouldUseDark);
      })();
    </script>
  </head>
  <body class="bg-[var(--bg)] text-[var(--text)]">
    <header class="sticky top-0 z-40 border-b border-[var(--border)] bg-[color-mix(in_srgb,var(--bg)_85%,transparent)] backdrop-blur">
      <div class="mx-auto flex max-w-5xl items-center justify-between px-6 py-4">
        <a href="/assetto-corsa" class="flex items-center gap-3 font-semibold">
          <span class="inline-flex h-11 w-11 items-center justify-center rounded-2xl bg-[var(--primary)] text-white text-lg">AC</span>
          <div class="text-sm text-[var(--muted)] leading-tight">
            <span class="block text-[var(--text)] font-semibold">Lap Board</span>
            <span>Assetto Corsa</span>
          </div>
        </a>
        <nav class="hidden items-center gap-6 text-sm md:flex">
          {navLinks.map((link) => (
            <a href={link.href} class="nav-link uppercase tracking-wide text-[var(--muted)] hover:text-[var(--primary)]">
              {link.label}
            </a>
          ))}
          <button type="button" data-theme-toggle class="btn btn-ghost text-xs uppercase">
            <span class="dark:hidden flex items-center gap-2"><span aria-hidden="true">☾</span>Dark</span>
            <span class="hidden dark:flex items-center gap-2"><span aria-hidden="true">☀</span>Light</span>
          </button>
        </nav>
        <button type="button" data-menu-toggle class="md:hidden rounded-xl border border-[var(--border)] px-4 py-2 text-sm">
          Menu
        </button>
      </div>
      <div data-mobile-menu class="md:hidden border-t border-[var(--border)] px-6 py-4 space-y-3" hidden>
        {navLinks.map((link) => (
          <a href={link.href} class="block text-sm text-[var(--muted)]">
            {link.label}
          </a>
        ))}
        <button type="button" data-theme-toggle-mobile class="btn btn-ghost w-full text-xs uppercase">
          Toggle tema
        </button>
      </div>
    </header>

    <main class="mx-auto max-w-5xl px-6 py-16 space-y-16">
      <slot />
    </main>

    <footer class="border-t border-[var(--border)] bg-[color-mix(in_srgb,var(--bg)_92%,transparent)]">
      <div class="mx-auto flex max-w-5xl flex-col gap-3 px-6 py-8 text-sm text-[var(--muted)] md:flex-row md:items-center md:justify-between">
        <span>Built with Astro + React · Data from personalbest.ini</span>
        <div class="flex gap-4 text-xs uppercase tracking-wide">
          <a href="https://github.com/yeftakun/my-site" target="_blank" rel="noreferrer" class="hover:text-[var(--primary)]">Referensi</a>
          <a href="https://assetto-db.com/" target="_blank" rel="noreferrer" class="hover:text-[var(--primary)]">Assetto DB</a>
        </div>
      </div>
    </footer>

    <script is:inline>
      const toggles = document.querySelectorAll('[data-theme-toggle], [data-theme-toggle-mobile]');
      const root = document.documentElement;
      const menuToggle = document.querySelector('[data-menu-toggle]');
      const mobileMenu = document.querySelector('[data-mobile-menu]');
      toggles.forEach((btn) => {
        btn.addEventListener('click', () => {
          const isDark = root.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
      });
      menuToggle?.addEventListener('click', () => {
        const hidden = mobileMenu?.hasAttribute('hidden');
        mobileMenu?.toggleAttribute('hidden', !hidden);
      });
    </script>
  </body>
</html>
